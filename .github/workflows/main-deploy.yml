name: Complete Deploy Pipeline

# Trigger del workflow: push sul branch master  
on:
  push:
    branches: [ master ]

jobs:
  deploy:
    name: Deploy via Webhook
    runs-on: ubuntu-latest
    
    steps:
    # 1. Checkout del codice
    - name: Checkout code
      uses: actions/checkout@v4
          
    # 2. Trigger deploy webhook sul server
    - name: Trigger Deploy Webhook
      run: |
        echo "ðŸš€ Triggering deploy webhook on server..."
        echo "Repository: ${{ github.repository }}"
        echo "Branch: ${{ github.ref_name }}" 
        echo "Commit: ${{ github.sha }}"
        echo "Author: ${{ github.actor }}"
        
        # Invia richiesta al webhook server
        curl -f -X POST "http://90.147.144.144:8080/deploy" \
          -H "Content-Type: application/json" \
          -d '{
            "repository": "${{ github.repository }}",
            "branch": "${{ github.ref_name }}",
            "commit": "${{ github.sha }}",
            "author": "${{ github.actor }}"
          }' --connect-timeout 30 --max-time 60
        
        echo "âœ… Deploy webhook sent successfully!"